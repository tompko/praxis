<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
<title>Cuckoo Hashing &laquo;  Programming Praxis</title>
</head>
<body>
<div class="entrytitle">
<h2>Cuckoo&nbsp;Hashing</h2>
<h3>February 1, 2011</h3>
</div>
<div class="entrybody">
<p><img src="http://programmingpraxis.files.wordpress.com/2011/01/cuckoo.png?w=640" alt="By Rasmus Pagh.  Licensed under CC BY-SA 3.0." align="right" />Hashing is a way of maintaining a dictionary data structure that provides insert, delete and lookup operations.  The most common hashing method, called chained hashing, uses a single hash function to provide an offset into an array; each bucket contains a linked list, which is searched to find the desired item. This method is fast if the hash function does a good job of distributing the keys, with average access in constant time, but has an annoying linear-time worst case if all the keys hash to the same value.</p>
<p>An alternate hashing method, called cuckoo hashing, was <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.25.4189">invented</a> by Rasmus Pagh and Flemming Friche Rodler.  The advantage of cuckoo hashing is that it <em>guarantees</em> constant-time lookups, and its amortized-constant-time insertions are within a constant factor of optimal.  The code that implements cuckoo hashing is simple, and cuckoo hashing performs very well in practice.</p>
<p>In cuckoo hashing, instead of storing a list of key/value pairs in a single bucket, each &#8220;nest&#8221; position in an array either has a single key/value pair, or is empty.  And instead of a single hash function, there are two; any key must be found at one of the two nests, guaranteeing constant-time lookup. Insertion works by looking at the two possible nests; if either is empty, the new key/value pair is placed there, but if both are occupied, the item being inserted is placed in one of them and the displaced item is then inserted recursively in a different nest.  If insertion ever encounters a cycle, the whole data structure is rehashed into a new one using two new hash functions; it is possible that rehashing encounters a new cycle, and so on, <em>ad idfinitum</em>, but in practice that almost never happens, and if it does, can be fixed by increasing the size of the array.  The diagram at right shows a chain of key/value pairs; note the cycle between H and W.  Cuckoo hashing derives its name from the behavior of the cuckoo bird that makes its nest by finding another bird&#8217;s nest and driving away its original occupant.</p>
<p>Several variants of cuckoo hashing have been described in the academic literature.  The biggest disadvantage of cuckoo hashing is wasted space; the version described above requires a load factor of no more than 50% nests occupied by key/value pairs in order to guarantee amortized-constant-time insertions.  Adding a third hash function increases the average fill rate from 50% to 91%, and adding additional hash functions increases that rate even more.  Another possibility is to allow a fixed number of items, greater than one, in each slot of the hash table; increasing from one item to two increases the average fill rate to 80%.  Of course, these ideas can be used together; using three &#8220;hatch&#8221; functions and two birds per nest increases the average fill rate to 97%, and even higher fill rates are possible, though at the cost of more work per item (but the big-oh time guarantees remain unchanged).  Most real implementations of cuckoo hashing provide for the number of nests to change dynamically, growing and shrinking as the number of items in the table changes.  </p>
<p>Your task is to write a library that maintains a dictionary of key/value pairs using cuckoo hashing; you should provide operators for the three basic operators (lookup, insert and delete) plus a function to extract the key/value pairs to a list. When you are finished, you are welcome to <a href="/2011/02/01/cuckoo-hashing/2/">read</a> or <a href="http://programmingpraxis.codepad.org/LIYEw8xo">run</a> a suggested solution, or to post your own solution or discuss the exercise in the comments below.</p>
<div id="wpcom_below_post" class="wpadvert" style="text-align: center; padding: 5px; background: #; padding: 5px; margin: 10px auto; width: 310px;">
<!-- <span style="text-align: left; letter-spacing: 1px; font: 8px/1em Verdana, sans-serif; color: #ccc; text-transform: uppercase; display: block; padding: 0 1px;">Advertisement</span> -->
<script type="text/javascript">
LD_AddCustomAttr("AdOpt", "1");
LD_AddCustomAttr("Origin", "other");
LD_AddCustomAttr("theme_bg", "ffffff"); 
LD_AddCustomAttr("theme_text", "555555"); 
LD_AddCustomAttr("theme_link", "557799"); 
LD_AddCustomAttr("theme_border", "C8A799"); 
LD_AddCustomAttr("theme_url", "8FB1D3"); 
LD_AddCustomAttr("LangId", "1");
LD_AddCustomAttr("Autotag", "science");
LD_AddCustomAttr("Autotag", "technology");
LD_AddCustomAttr("Tag", "exercises");

LD_AddSlot("wpcom_below_post");
LD_GetBids();
</script>
</div><div class="sharedaddy sd-like-enabled"><div id="wpl-likebox" class="sd-block sd-like"><h3 class="sd-title">Like this:</h3><div class="sd-content"><div id="wpl-button"><a href="http://programmingpraxis.com/2011/02/01/cuckoo-hashing/?like=1&amp;_wpnonce=a72c2c6ab5" title="I like this post" class="like needs-login sd-button" rel="nofollow"><span>Like</span></a></div><div id="wpl-count" class="sd-like-count">Be the first to like this post.</div></div></div></div> <p>Pages: 1 <a href="http://programmingpraxis.com/2011/02/01/cuckoo-hashing/2/">2</a></p> </div></div>
</body>
</html>
