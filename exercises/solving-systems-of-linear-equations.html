<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
<title>Solving Systems Of Linear Equations &laquo;  Programming Praxis</title>
</head>
<body>
<div class="entrytitle">
<h2>Solving Systems Of Linear&nbsp;Equations</h2>
<h3>July 20, 2010</h3>
</div>
<div class="entrybody">
<p>In today&#8217;s exercise we continue the examination of matrix operations that we began <a href="/2010/06/22/matrix-operations/">previously</a>.  Our goal is to be able to solve a system of equations; along the way we will see two methods for decomposing matrices.</p>
<p>We begin with some terminology.  All the matrices we will be looking at are square, meaning that they have the same number of rows and columns.  A lower-triangular matrix <em>L</em> has all entries <em>L</em><sub><em>ij</em></sub> = 0 for <em>i</em> &lt; <em>j</em>; thus, all entries above the main northwest-to-southeast diagonal are zero.  An upper-triangular matrix <em>U</em> has all entries <em>U</em><sub><em>ij</em></sub> = 0 for <em>i</em> &gt; <em>j</em>; thus, all entries below the main northwest-to-southeast diagonal are zero.  A lower- or upper-triangular matrix is unit lower- or upper-triangular if all the entries along the main diagonal are 1.  A permutation matrix <em>P</em> has exactly one 1 in each row and column and 0 elsewhere; it is called a permutation matrix because multiplying a vector <em>X</em> by a permutation matrix has the effect of permuting the elements of <em>X</em>.  The identity matrix <em>I</em> has 1 in each entry along the main diagonal and 0 elsewhere.  A matrix <em>M</em> is singular if it has no inverse, that is, there is no matrix <em>M</em><sup>-1</sup> such that <em>M</em> <em>M</em><sup>-1</sup> = <em>I</em>.</p>
<p>An LU decomposition of a matrix <em>A</em> finds two matrices <em>L</em>, which is unit lower-triangular, and <em>U</em>, which is upper-triangular, such that <em>A</em> = <em>L U</em>.  The algorithm is called <em>Gaussian elimination</em>, and works from top to bottom.  First, multiples of the first equation are subtracted from the other equations so that the first variable is removed from those equations.  Then multiples of the second equation are subtracted from the remaining equations so that the second variable is removed from those equations.  Then the third equation, and the fourth, and so on, until all the equations have been processed and the matrix is in upper-triangular form.  Here is an example of the LU decomposition of matrix <em>A</em> into its factors <em>L</em> &times; <em>U</em>:</p>
<p><img src="http://s0.wp.com/latex.php?latex=%5Cbegin%7Bpmatrix%7D+2+%26+3+%26+1+%26+5+%5C%5C+6+%26+13+%26+5+%26+19+%5C%5C+2+%26+19+%26+10+%26+23+%5C%5C+4+%26+10+%26+11+%26+31+%5Cend%7Bpmatrix%7D+%3D+%5Cbegin%7Bpmatrix%7D+1+%26+0+%26+0+%26+0+%5C%5C+3+%26+1+%26+0+%26+0+%5C%5C+1+%26+4+%26+1+%26+0+%5C%5C+2+%26+1+%26+7+%26+1+%5Cend%7Bpmatrix%7D+%5Ctimes+%5Cbegin%7Bpmatrix%7D+2+%26+3+%26+1+%26+5+%5C%5C+0+%26+4+%26+2+%26+4+%5C%5C+0+%26+0+%26+1+%26+2+%5C%5C+0+%26+0+%26+0+%26+3+%5Cend%7Bpmatrix%7D+&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="\begin{pmatrix} 2 &amp; 3 &amp; 1 &amp; 5 \\ 6 &amp; 13 &amp; 5 &amp; 19 \\ 2 &amp; 19 &amp; 10 &amp; 23 \\ 4 &amp; 10 &amp; 11 &amp; 31 \end{pmatrix} = \begin{pmatrix} 1 &amp; 0 &amp; 0 &amp; 0 \\ 3 &amp; 1 &amp; 0 &amp; 0 \\ 1 &amp; 4 &amp; 1 &amp; 0 \\ 2 &amp; 1 &amp; 7 &amp; 1 \end{pmatrix} \times \begin{pmatrix} 2 &amp; 3 &amp; 1 &amp; 5 \\ 0 &amp; 4 &amp; 2 &amp; 4 \\ 0 &amp; 0 &amp; 1 &amp; 2 \\ 0 &amp; 0 &amp; 0 &amp; 3 \end{pmatrix} " title="\begin{pmatrix} 2 &amp; 3 &amp; 1 &amp; 5 \\ 6 &amp; 13 &amp; 5 &amp; 19 \\ 2 &amp; 19 &amp; 10 &amp; 23 \\ 4 &amp; 10 &amp; 11 &amp; 31 \end{pmatrix} = \begin{pmatrix} 1 &amp; 0 &amp; 0 &amp; 0 \\ 3 &amp; 1 &amp; 0 &amp; 0 \\ 1 &amp; 4 &amp; 1 &amp; 0 \\ 2 &amp; 1 &amp; 7 &amp; 1 \end{pmatrix} \times \begin{pmatrix} 2 &amp; 3 &amp; 1 &amp; 5 \\ 0 &amp; 4 &amp; 2 &amp; 4 \\ 0 &amp; 0 &amp; 1 &amp; 2 \\ 0 &amp; 0 &amp; 0 &amp; 3 \end{pmatrix} " class="latex" /></p>
<p>There are two problems with LU decomposition:  First, the algorithm leads to a divide-by-zero error on singular matrices.  Second, it is prone to numerical instability for small divisors.  The solution is to rearrange, or permute, the equations so that the pivot element is always the largest remaining element, greatly reducing the likelihood of numerical instability.</p>
<p>An improved decomposition is the LUP decomposition, which finds for an input matrix <em>A</em> three matrices <em>L</em>, <em>U</em>, and a permutation matrix <em>P</em> such that <em>P A</em> = <em>L U</em>. Rather than actually moving equations, the permutation matrix records the rearrangements.  For example, here is the LUP decomposition of the matrix <em>A</em> given by <em>P</em> &times; <em>A</em> = <em>L</em> &times; <em>U</em>:</p>
<p><img src="http://s0.wp.com/latex.php?latex=%5Cbegin%7Bpmatrix%7D+0+%26+0+%26+1+%26+0+%5C%5C+1+%26+0+%26+0+%26+0+%5C%5C+0+%26+0+%26+0+%26+1+%5C%5C+0+%26+1+%26+0+%26+0+%5Cend%7Bpmatrix%7D+%5Ctimes+%5Cbegin%7Bpmatrix%7D+2+%26+0+%26+2+%26+3%2F5+%5C%5C+3+%26+3+%26+4+%26+-2+%5C%5C+5+%26+5+%26+4+%26+2+%5C%5C+-1+%26+-2+%26+17%2F5+%26+-1+%5Cend%7Bpmatrix%7D+%3D+%5Cbegin%7Bpmatrix%7D+1+%26+0+%26+0+%26+0+%5C%5C+2%2F5+%26+1+%26+0+%26+0+%5C%5C+-1%2F5+%26+1%2F2+%26+1+%26+0+%5C%5C+3%2F5+%26+0+%26+2%2F5+%26+1+%5Cend%7Bpmatrix%7D+%5Ctimes+%5Cbegin%7Bpmatrix%7D+5+%26+5+%26+4+%26+2+%5C%5C+0+%26+-2+%26+2%2F5+%26+-1%2F5+%5C%5C+0+%26+0+%26+4+%26+-1%2F2+%5C%5C+0+%26+0+%26+0+%26+-3+%5Cend%7Bpmatrix%7D+&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="\begin{pmatrix} 0 &amp; 0 &amp; 1 &amp; 0 \\ 1 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 1 \\ 0 &amp; 1 &amp; 0 &amp; 0 \end{pmatrix} \times \begin{pmatrix} 2 &amp; 0 &amp; 2 &amp; 3/5 \\ 3 &amp; 3 &amp; 4 &amp; -2 \\ 5 &amp; 5 &amp; 4 &amp; 2 \\ -1 &amp; -2 &amp; 17/5 &amp; -1 \end{pmatrix} = \begin{pmatrix} 1 &amp; 0 &amp; 0 &amp; 0 \\ 2/5 &amp; 1 &amp; 0 &amp; 0 \\ -1/5 &amp; 1/2 &amp; 1 &amp; 0 \\ 3/5 &amp; 0 &amp; 2/5 &amp; 1 \end{pmatrix} \times \begin{pmatrix} 5 &amp; 5 &amp; 4 &amp; 2 \\ 0 &amp; -2 &amp; 2/5 &amp; -1/5 \\ 0 &amp; 0 &amp; 4 &amp; -1/2 \\ 0 &amp; 0 &amp; 0 &amp; -3 \end{pmatrix} " title="\begin{pmatrix} 0 &amp; 0 &amp; 1 &amp; 0 \\ 1 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 1 \\ 0 &amp; 1 &amp; 0 &amp; 0 \end{pmatrix} \times \begin{pmatrix} 2 &amp; 0 &amp; 2 &amp; 3/5 \\ 3 &amp; 3 &amp; 4 &amp; -2 \\ 5 &amp; 5 &amp; 4 &amp; 2 \\ -1 &amp; -2 &amp; 17/5 &amp; -1 \end{pmatrix} = \begin{pmatrix} 1 &amp; 0 &amp; 0 &amp; 0 \\ 2/5 &amp; 1 &amp; 0 &amp; 0 \\ -1/5 &amp; 1/2 &amp; 1 &amp; 0 \\ 3/5 &amp; 0 &amp; 2/5 &amp; 1 \end{pmatrix} \times \begin{pmatrix} 5 &amp; 5 &amp; 4 &amp; 2 \\ 0 &amp; -2 &amp; 2/5 &amp; -1/5 \\ 0 &amp; 0 &amp; 4 &amp; -1/2 \\ 0 &amp; 0 &amp; 0 &amp; -3 \end{pmatrix} " class="latex" /></p>
<p>Given the LUP decomposition, it is simple to solve a system of linear equations. Forward substitution solves the lower-triangular system by calculating the first variable, which is part of an equation with one unknown, then substitutes that into the second equation, reducing it from two unknowns to one unknown, and so on.  Then back substitution runs backward, calculating the final values of the variables in the original matrix.  Here&#8217;s an example, where we wish to solve for the vector <em>X</em> given <em>A X</em> = <em>B</em>:</p>
<p><img src="http://s0.wp.com/latex.php?latex=%5Cbegin%7Bpmatrix%7D+1+%26+2+%26+0+%5C%5C+3+%26+5+%26+4+%5C%5C+5+%26+6+%26+3+%5Cend%7Bpmatrix%7D+X+%3D+%5Cbegin%7Bpmatrix%7D+1%2F10+%5C%5C+25%2F2+%5C%5C+103%2F10+%5Cend%7Bpmatrix%7D+&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="\begin{pmatrix} 1 &amp; 2 &amp; 0 \\ 3 &amp; 5 &amp; 4 \\ 5 &amp; 6 &amp; 3 \end{pmatrix} X = \begin{pmatrix} 1/10 \\ 25/2 \\ 103/10 \end{pmatrix} " title="\begin{pmatrix} 1 &amp; 2 &amp; 0 \\ 3 &amp; 5 &amp; 4 \\ 5 &amp; 6 &amp; 3 \end{pmatrix} X = \begin{pmatrix} 1/10 \\ 25/2 \\ 103/10 \end{pmatrix} " class="latex" /></p>
<p>The LUP decomposition <em>P A</em> = <em>L U</em> is</p>
<p><img src="http://s0.wp.com/latex.php?latex=%5Cbegin%7Bpmatrix%7D+0+%26+0+%26+1+%5C%5C+0+%26+1+%26+0+%5C%5C+1+%26+0+%26+0+%5Cend%7Bpmatrix%7D+%5Ctimes+%5Cbegin%7Bpmatrix%7D+1+%26+2+%26+0+%5C%5C+3+%26+5+%26+4+%5C%5C+5+%26+6+%26+3+%5Cend%7Bpmatrix%7D+%3D+%5Cbegin%7Bpmatrix%7D+1+%26+0+%26+0+%5C%5C+3%2F5+%26+1+%26+0+%5C%5C+1%2F5+%26+4%2F7+%26+1+%5Cend%7Bpmatrix%7D+%5Ctimes+%5Cbegin%7Bpmatrix%7D+5+%26+6+%26+3+%5C%5C+0+%26+7%2F5+%26+11%2F5+%5C%5C+0+%26+0+%26+-13%2F7+%5Cend%7Bpmatrix%7D+&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="\begin{pmatrix} 0 &amp; 0 &amp; 1 \\ 0 &amp; 1 &amp; 0 \\ 1 &amp; 0 &amp; 0 \end{pmatrix} \times \begin{pmatrix} 1 &amp; 2 &amp; 0 \\ 3 &amp; 5 &amp; 4 \\ 5 &amp; 6 &amp; 3 \end{pmatrix} = \begin{pmatrix} 1 &amp; 0 &amp; 0 \\ 3/5 &amp; 1 &amp; 0 \\ 1/5 &amp; 4/7 &amp; 1 \end{pmatrix} \times \begin{pmatrix} 5 &amp; 6 &amp; 3 \\ 0 &amp; 7/5 &amp; 11/5 \\ 0 &amp; 0 &amp; -13/7 \end{pmatrix} " title="\begin{pmatrix} 0 &amp; 0 &amp; 1 \\ 0 &amp; 1 &amp; 0 \\ 1 &amp; 0 &amp; 0 \end{pmatrix} \times \begin{pmatrix} 1 &amp; 2 &amp; 0 \\ 3 &amp; 5 &amp; 4 \\ 5 &amp; 6 &amp; 3 \end{pmatrix} = \begin{pmatrix} 1 &amp; 0 &amp; 0 \\ 3/5 &amp; 1 &amp; 0 \\ 1/5 &amp; 4/7 &amp; 1 \end{pmatrix} \times \begin{pmatrix} 5 &amp; 6 &amp; 3 \\ 0 &amp; 7/5 &amp; 11/5 \\ 0 &amp; 0 &amp; -13/7 \end{pmatrix} " class="latex" />,</p>
<p>the result of forward substitution <em>L Y</em> = <em>P B</em> is</p>
<p><img src="http://s0.wp.com/latex.php?latex=%5Cbegin%7Bpmatrix%7D+1+%26+0+%26+0+%5C%5C+3%2F5+%26+1+%26+0+%5C%5C+1%2F5+%26+4%2F7+%26+1+%5Cend%7Bpmatrix%7D+%5Ctimes+Y+%3D+%5Cbegin%7Bpmatrix%7D+0+%26+0+%26+1+%5C%5C+0+%26+1+%26+0+%5C%5C+1+%26+0+%26+0+%5Cend%7Bpmatrix%7D+%5Ctimes+%5Cbegin%7Bpmatrix%7D+1%2F10+%5C%5C+25%2F2+%5C%5C+103%2F10+%5Cend%7Bpmatrix%7D+%3D+%5Cbegin%7Bpmatrix%7D+103%2F10+%5C%5C+25%2F2+%5C%5C+1%2F10+%5Cend%7Bpmatrix%7D+&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="\begin{pmatrix} 1 &amp; 0 &amp; 0 \\ 3/5 &amp; 1 &amp; 0 \\ 1/5 &amp; 4/7 &amp; 1 \end{pmatrix} \times Y = \begin{pmatrix} 0 &amp; 0 &amp; 1 \\ 0 &amp; 1 &amp; 0 \\ 1 &amp; 0 &amp; 0 \end{pmatrix} \times \begin{pmatrix} 1/10 \\ 25/2 \\ 103/10 \end{pmatrix} = \begin{pmatrix} 103/10 \\ 25/2 \\ 1/10 \end{pmatrix} " title="\begin{pmatrix} 1 &amp; 0 &amp; 0 \\ 3/5 &amp; 1 &amp; 0 \\ 1/5 &amp; 4/7 &amp; 1 \end{pmatrix} \times Y = \begin{pmatrix} 0 &amp; 0 &amp; 1 \\ 0 &amp; 1 &amp; 0 \\ 1 &amp; 0 &amp; 0 \end{pmatrix} \times \begin{pmatrix} 1/10 \\ 25/2 \\ 103/10 \end{pmatrix} = \begin{pmatrix} 103/10 \\ 25/2 \\ 1/10 \end{pmatrix} " class="latex" />, giving <img src="http://s0.wp.com/latex.php?latex=Y+%3D+%5Cbegin%7Bpmatrix%7D+103%2F10+%5C%5C+158%2F25+%5C%5C+-39%2F7+%5Cend%7Bpmatrix%7D+&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="Y = \begin{pmatrix} 103/10 \\ 158/25 \\ -39/7 \end{pmatrix} " title="Y = \begin{pmatrix} 103/10 \\ 158/25 \\ -39/7 \end{pmatrix} " class="latex" />,</p>
<p>and the result of the back substitution <em>U X</em> = <em>Y</em> is</p>
<p><img src="http://s0.wp.com/latex.php?latex=%5Cbegin%7Bpmatrix%7D+5+%26+6+%26+3+%5C%5C+0+%26+7%2F5+%26+11%2F5+%5C%5C+0+%26+0+%26+-13%2F7+%5Cend%7Bpmatrix%7D+%5Ctimes+X+%3D+%5Cbegin%7Bpmatrix%7D+103%2F10+%5C%5C+158%2F25+%5C%5C+-39%2F7+%5Cend%7Bpmatrix%7D+&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="\begin{pmatrix} 5 &amp; 6 &amp; 3 \\ 0 &amp; 7/5 &amp; 11/5 \\ 0 &amp; 0 &amp; -13/7 \end{pmatrix} \times X = \begin{pmatrix} 103/10 \\ 158/25 \\ -39/7 \end{pmatrix} " title="\begin{pmatrix} 5 &amp; 6 &amp; 3 \\ 0 &amp; 7/5 &amp; 11/5 \\ 0 &amp; 0 &amp; -13/7 \end{pmatrix} \times X = \begin{pmatrix} 103/10 \\ 158/25 \\ -39/7 \end{pmatrix} " class="latex" />, giving <img src="http://s0.wp.com/latex.php?latex=X+%3D+%5Cbegin%7Bpmatrix%7D+1%2F2+%5C%5C+-1%2F5+%5C%5C+3+%5Cend%7Bpmatrix%7D+&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="X = \begin{pmatrix} 1/2 \\ -1/5 \\ 3 \end{pmatrix} " title="X = \begin{pmatrix} 1/2 \\ -1/5 \\ 3 \end{pmatrix} " class="latex" />,</p>
<p>which is the solution.</p>
<p>Your task is to write functions that perform LU-decomposition and LUP-decomposition and solve systems of linear equations.  When you are finished, you are welcome to <a href="/2010/07/20/solving-systems-of-linear-equations/2/">read</a> or <a href="http://programmingpraxis.codepad.org/Eec8zXDy">run</a> a suggested solution, or to post your own solution or discuss the exercise in the comments below.</p>
</div>
</body>
</html>
