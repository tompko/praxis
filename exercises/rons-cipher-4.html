<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
<title>Ron&#8217;s Cipher #4 &laquo;  Programming Praxis</title>
</head>
<body>
<div class="entrytitle">
<h2>Ron&#8217;s Cipher&nbsp;#4</h2>
<h3>September 4, 2009</h3>
</div>
<div class="entrybody">
<p>RC4 is a stream cipher, similar to the Blum Blum Shub cipher of an earlier <a href="/2009/08/18/blum-blum-shub/">exercise</a>, invented by Ron Rivest in 1987.  RC4 provides encryption for the SSL protocol that permits secure internet connections and the WEP protocol that secures wireless networks.</p>
<p>RC4 works by using a key to initialize a 256-byte array, which then forms the basis of a pseudo-random byte generator.  The stream of random bytes is xor&#8217;ed with plaintext to produce ciphertext; decryption is performed by xor&#8217;ing the same stream of random bytes with the ciphertext to produce plaintext.</p>
<p>The key array K is initialized like this:</p>
<p><code>for i from 0 to 255<br />
&nbsp;&nbsp;&nbsp;&nbsp;K[i] := i</code></p>
<p><code>j := 0</code></p>
<p><code>for i from 0 to 255<br />
&nbsp;&nbsp;&nbsp;&nbsp;j := (j + K[i] + key[i mod klen]) mod 256<br />
&nbsp;&nbsp;&nbsp;&nbsp;swap K[i], K[j]</code></p>
<p>Once the key array is initialized, the pseudo-random byte generator uses a similar calculation to build the stream of random bytes:</p>
<p><code>i := 0<br />
j := 0</code></p>
<p><code>start:<br />
&nbsp;&nbsp;&nbsp;&nbsp;i := (i + 1) mod 256<br />
&nbsp;&nbsp;&nbsp;&nbsp;j := (j + K[i]) mod 256<br />
&nbsp;&nbsp;&nbsp;&nbsp;swap K[i], K[j]<br />
&nbsp;&nbsp;&nbsp;&nbsp;output K[ (K[i] + K[j]) mod 256 ]<br />
&nbsp;&nbsp;&nbsp;&nbsp;goto start</code></p>
<p>Your task is to write a function that takes a key and a text and produces the corresponding output text; the same function can be used for both encryption and decryption.  When you are finished, you are welcome to <a href="/2009/09/04/rons-cipher-4/2/">read</a> or <a href="http://programmingpraxis.codepad.org/pQc8OwsW">run</a> a suggested solution, or to post your solution or discuss the exercise in the comments below.</p>
</div>
</body>
</html>
