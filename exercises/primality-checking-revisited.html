<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
<title>Primality Checking, Revisited &laquo;  Programming Praxis</title>
</head>
<body>
<div class="entrytitle">
<h2>Primality Checking,&nbsp;Revisited</h2>
<h3>January 26, 2010</h3>
</div>
<div class="entrybody">
<p>We examined the Miller-Rabin probabilistic primality checker in a previous <a href="/2009/05/01/primality-checking/">exercise</a>.  Today, we examine a primality checker that combines the Miller-Rabin test with a test on Lucas pseudoprimes, devised by Robert Baillie and described by Baillie and Wagstaff in their <a href="http://mpqs.free.fr/LucasPseudoprimes.pdf">article</a> &#8220;Lucas Pseudoprimes&#8221; in <em>Mathematics of Computation</em>, Volume 35, Number 152, pages 1391-1417, October 1980; see also Thomas Nicely&#8217;s <a href="http://www.trnicely.net/misc/bpsw.html">web page</a> devoted to Baillie&#8217;s test.  This is the same <a onclick="return mugicPopWin(this,event);" oncontextmenu="mugicRightClick(this);" href="http://mathworld.wolfram.com/LucasPseudoprime.html">algorithm</a> used in the <code>PrimeQ</code> function in <em>Mathematica</em>.</p>
<p>Lucas numbers are defined by a recurrence formula similar to Fibonacci numbers, where <img src="http://s0.wp.com/latex.php?latex=L_n+%3D+L_%7Bn-1%7D+%2B+L_%7Bn-2%7D&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="L_n = L_{n-1} + L_{n-2}" title="L_n = L_{n-1} + L_{n-2}" class="latex" /> with <img src="http://s0.wp.com/latex.php?latex=L_1+%3D+1&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="L_1 = 1" title="L_1 = 1" class="latex" /> and <img src="http://s0.wp.com/latex.php?latex=L_2+%3D+3&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="L_2 = 3" title="L_2 = 3" class="latex" />; the Lucas numbers are 1, 3, 4, 7, 11, 18, 29, 47, 76, 123, &hellip; (Sloane&#8217;s <a href="http://www.research.att.com/~njas/sequences/A000204">A000204</a>).  Lucas numbers have the rather startling property that, if <em>n</em> is prime, <img src="http://s0.wp.com/latex.php?latex=L_n+%5Cequiv+1+%5Cpmod%7Bn%7D&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="L_n \equiv 1 \pmod{n}" title="L_n \equiv 1 \pmod{n}" class="latex" />.  But the converse is not true, and composite numbers <em>n</em> such that <img src="http://s0.wp.com/latex.php?latex=L_n+%5Cequiv+1+%5Cpmod%7Bn%7D&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="L_n \equiv 1 \pmod{n}" title="L_n \equiv 1 \pmod{n}" class="latex" /> are known as Lucas pseudoprimes; the first few Lucas pseudoprimes are 705, 2465, 2737, 3745, 4171, &hellip; (Sloane&#8217;s <a href="http://www.research.att.com/~njas/sequences/A005845">A005845</a>).</p>
<p>Lucas numbers are a special case of <a onclick="return mugicPopWin(this,event);" oncontextmenu="mugicRightClick(this);" href="http://mathworld.wolfram.com/LucasSequence.html">Lucas sequences</a>.  If <em>P</em> and <em>Q</em> are integers such that the discriminant <img src="http://s0.wp.com/latex.php?latex=D+%3D+P%5E2+-+4Q&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="D = P^2 - 4Q" title="D = P^2 - 4Q" class="latex" />, then the roots of <img src="http://s0.wp.com/latex.php?latex=x%5E2+-+P+x+%2B+Q+%3D+0&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="x^2 - P x + Q = 0" title="x^2 - P x + Q = 0" class="latex" /> are <img src="http://s0.wp.com/latex.php?latex=a+%3D+%5Cfrac%7BP+%2B+%5Csqrt%7BD%7D%7D%7B2%7D&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="a = \frac{P + \sqrt{D}}{2}" title="a = \frac{P + \sqrt{D}}{2}" class="latex" /> and <img src="http://s0.wp.com/latex.php?latex=b+%3D+%5Cfrac%7BP+-+%5Csqrt%7BD%7D%7D%7B2%7D&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="b = \frac{P - \sqrt{D}}{2}" title="b = \frac{P - \sqrt{D}}{2}" class="latex" />.  There are two Lucas sequences <img src="http://s0.wp.com/latex.php?latex=U_n%28P%2C+Q%29+%3D+%5Cfrac%7Ba%5En+-+b%5En%7D%7Ba+-+b%7D&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="U_n(P, Q) = \frac{a^n - b^n}{a - b}" title="U_n(P, Q) = \frac{a^n - b^n}{a - b}" class="latex" /> and <img src="http://s0.wp.com/latex.php?latex=V_n%28P%2C+Q%29+%3D+a%5En+%2B+b%5En&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="V_n(P, Q) = a^n + b^n" title="V_n(P, Q) = a^n + b^n" class="latex" /> for <img src="http://s0.wp.com/latex.php?latex=n+%5Cgeq+0&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="n \geq 0" title="n \geq 0" class="latex" />, which can be computed by the recurrence equations <img src="http://s0.wp.com/latex.php?latex=U_m%28P%2CQ%29+%3D+P+U_%7Bm-1%7D%28P%2CQ%29+-+Q+U_%7Bm-2%7D%28P%2CQ%29&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="U_m(P,Q) = P U_{m-1}(P,Q) - Q U_{m-2}(P,Q)" title="U_m(P,Q) = P U_{m-1}(P,Q) - Q U_{m-2}(P,Q)" class="latex" /> and <img src="http://s0.wp.com/latex.php?latex=V_m%28P%2CQ%29+%3D+P+V_%7Bm-1%7D%28P%2CQ%29+-+Q+V_%7Bm-2%7D%28P%2CQ%29&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="V_m(P,Q) = P V_{m-1}(P,Q) - Q V_{m-2}(P,Q)" title="V_m(P,Q) = P V_{m-1}(P,Q) - Q V_{m-2}(P,Q)" class="latex" />.  The Lucas numbers are given by the sequence <img src="http://s0.wp.com/latex.php?latex=V%281%2C-1%29&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="V(1,-1)" title="V(1,-1)" class="latex" /> and the Fibonacci numbers are given by the sequence <img src="http://s0.wp.com/latex.php?latex=U%281%2C-1%29&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="U(1,-1)" title="U(1,-1)" class="latex" />.</p>
<p>We will want to compute the <em>n</em>th element of a Lucas sequence, mod <em>n</em>, for large <em>n</em>.  Rather than computing the entire recurrence in time proportional to <em>n</em>, it is possible to use doubling and halving, in the same way as the <a href="/2010/01/15/three-binary-algorithms/">exercise</a> on Three Binary Algorithms, to compute the <em>n</em>th element in log <em>n</em> time.  Such a computation is known as a Lucas chain.</p>
<p>Thus, to test whether an odd number <em>n</em> is a Lucas pseudoprime, we choose sequence parameters <em>P</em> and <em>Q</em> so that the the discriminant <em>D</em> is non-square and the Legendre number <img src="http://s0.wp.com/latex.php?latex=%5Cleft%28+%5Cbegin%7Barray%7D%7Bc%7D+D+%5C%5C+n%5Cend%7Barray%7D+%5Cright%29+%3D+-1&amp;bg=ffffff&amp;fg=555555&amp;s=0" alt="\left( \begin{array}{c} D \\ n\end{array} \right) = -1" title="\left( \begin{array}{c} D \\ n\end{array} \right) = -1" class="latex" /> (otherwise the modular arithmetic would fail).  Then we construct the Lucas chain; if the <em>n</em>th element is zero modulo <em>n</em>, then <em>n</em> is either prime or is a Lucas pseudoprime.</p>
<p>Recall that the Miller-Rabin test used strong pseudoprime tests on fifty bases to check primality.  Using Lucas pseudoprimes, we can reduce the number of tests substantially.  It turns out that combining two strong pseudoprime tests, with bases 2 and 3, with a Lucas pseudoprime test, there are no known pseudoprimes; the test has been performed exhaustively on all numbers less than 10<sup>16</sup>, and no counter-examples have been found in over twenty-five years of use (in addition to fifteen minutes of fame, there is a monetary reward from the original authors for the finder of a counter-example).</p>
<p>Your task is to write a function that checks primality using the algorithm described above.  When you are finished, you are welcome to <a href="/2010/01/26/primality-checking-revisited/2/">read</a> or <a href="http://programmingpraxis.codepad.org/07RDsaSw">run</a> a suggested solution, or to post your own solution or discuss the exercise in the comments below.</p>
<div id="wpcom_below_post" class="wpadvert" style="text-align: center; padding: 5px; background: #; padding: 5px; margin: 10px auto; width: 310px;">
<!-- <span style="text-align: left; letter-spacing: 1px; font: 8px/1em Verdana, sans-serif; color: #ccc; text-transform: uppercase; display: block; padding: 0 1px;">Advertisement</span> -->
<script type="text/javascript">
LD_AddCustomAttr("AdOpt", "1");
LD_AddCustomAttr("Origin", "other");
LD_AddCustomAttr("theme_bg", "ffffff"); 
LD_AddCustomAttr("theme_text", "555555"); 
LD_AddCustomAttr("theme_link", "557799"); 
LD_AddCustomAttr("theme_border", "C8A799"); 
LD_AddCustomAttr("theme_url", "8FB1D3"); 
LD_AddCustomAttr("LangId", "1");
LD_AddCustomAttr("Autotag", "technology");
LD_AddCustomAttr("Autotag", "entertainment");
LD_AddCustomAttr("Tag", "exercises");

LD_AddSlot("wpcom_below_post");
LD_GetBids();
</script>
</div><div class="sharedaddy sd-like-enabled"><div id="wpl-likebox" class="sd-block sd-like"><h3 class="sd-title">Like this:</h3><div class="sd-content"><div id="wpl-button"><a href="http://programmingpraxis.com/2010/01/26/primality-checking-revisited/?like=1&amp;_wpnonce=a72c2c6ab5" title="I like this post" class="like needs-login sd-button" rel="nofollow"><span>Like</span></a></div><div id="wpl-count" class="sd-like-count">Be the first to like this post.</div></div></div></div> <p>Pages: 1 <a href="http://programmingpraxis.com/2010/01/26/primality-checking-revisited/2/">2</a></p> </div></div>
</body>
</html>
