<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
<title>Treaps &laquo;  Programming Praxis</title>
</head>
<body>
<div class="entrytitle">
<h2>Treaps</h2>
<h3>June 26, 2009</h3>
</div>
<div class="entrybody">
<p>Dictionaries are a common data type, which we have used in several exercises (<a href="http://programmingpraxis.com/2009/02/27/mark-v-shaney/">Mark V. Shaney</a>, <a href="http://programmingpraxis.com/2009/03/10/word-frequencies/">Word Frequencies</a>, <a href="http://programmingpraxis.com/2009/03/20/dodgsons-doublets/">Dodgson&#8217;s Doublets</a>, <a href="http://programmingpraxis.com/2009/04/10/anagrams/">Anagrams</a>).  Hash tables are often used as the underlying implementation for dictionaries, and in a previous exercise we developed <a href="/2009/06/05/ternary-search-tries/">ternary search tries</a> as another implementation for dictionaries, which are useful when the keys are strings.  Today&#8217;s exercise examines treaps, which are yet another method for implementing dictionaries.</p>
<p>A treap is essentially a binary search tree, represented as either an empty node, called nil, or a node with a key and a value and pointers to two child nodes, the left child and the right child.  Binary search trees obey the rule that all nodes in the left child have keys that are less than the key of the current node, and all nodes in the right child have keys that are greater than the key of the current node.  One node is distinguished as the root of the tree; it is the only node visible outside the tree.  Obviously, a single set of keys could be represented by many different binary search trees, depending on which key is chosen as the root and the choices made at each level under the root.</p>
<p>The speed of a search depends on the depth at which the key is located in the tree.  Trees that have more balance (fewer nodes with nil children) are faster to search than trees that have less balance (more nodes with nil children) because the overall depth of the tree is less.  The two extreme cases occur when a tree is perfectly balanced (no internal nil nodes), when a search takes time logarithmic in the size of the tree, and when a tree is perfectly imbalanced (a long chain of nodes each with one nil child), when a search takes time linear in the size of the tree.</p>
<p>Treaps use an ingenious method to assure that the tree is approximately balanced at all times.  Each node, in addition to the key, value, and two child nodes, contains a numeric priority, which is randomly assigned at the time the node is created and never changed.  Of the many possible trees that could represent a particular set of keys, the one that is chosen obeys the heap-order property, with the priority of each node being greater than the priorities of all of its child nodes.  Assuming all keys and priorities are distinct, there will be exactly one tree that satisfies both the tree-order and heap-order properties; it is the same tree that would be created if keys were dynmically inserted into a normal binary search tree in order of the priority field.  The genius of this method is that the priorities are independent of the keys, making it extremely unlikely that highly-imbalanced trees could be created, thus keeping search times approximately logarithmic.</p>
<p>As nodes are dynamically inserted into and deleted from the tree, it is sometimes necessary to restructure the tree to maintain both the tree-order and the heap-order properties.  The restructurings, known as rotations, come in two varieties, left and right:</p>
<p align="center"><img src="http://programmingpraxis.files.wordpress.com/2009/06/tree-rotation.png?w=640" /></p>
<p>[ This <a href="http://commons.wikimedia.org/wiki/File:Tree_rotation.png">image</a>, by Ramasamy, is used under the terms of the GNU Free Documentation License or the Creative Commons Attribution Share-Alike License. ]</p>
<p>In both trees shown above, all the nodes in sub-tree <em>A</em> have keys less than <em>p</em>, all the nodes in sub-tree <em>B</em> have keys between <em>p</em> and <em>q</em>, and all the nodes in sub-tree <em>C</em> have keys greater than <em>q</em>.  Transforming the tree so that the root moves from <em>p</em> to <em>q</em> is called a left rotation, and transforming the tree so that the root moves from <em>q</em> to <em>p</em> is called a right rotation; in both cases the root node moves down the tree toward the leaves.  Note that both rotations preserve the tree-order property.  It is the goal of the insert and delete algorithms to use rotations to maintain the heap-order property.</p>
<p>Your task is to implement the lookup, insert, update, delete and enlist operations on treaps. When you are finished, you are welcome to <a href="/2009/06/26/treaps/2/">read</a> or <a href="http://programmingpraxis.codepad.org/iFm0jW0A">run</a> a suggested solution, or post your solution or discuss the exercise in the comments below.</p>
<div id="wpcom_below_post" class="wpadvert" style="text-align: center; padding: 5px; background: #; padding: 5px; margin: 10px auto; width: 310px;">
<!-- <span style="text-align: left; letter-spacing: 1px; font: 8px/1em Verdana, sans-serif; color: #ccc; text-transform: uppercase; display: block; padding: 0 1px;">Advertisement</span> -->
<script type="text/javascript">
LD_AddCustomAttr("AdOpt", "1");
LD_AddCustomAttr("Origin", "other");
LD_AddCustomAttr("theme_bg", "ffffff"); 
LD_AddCustomAttr("theme_text", "555555"); 
LD_AddCustomAttr("theme_link", "557799"); 
LD_AddCustomAttr("theme_border", "C8A799"); 
LD_AddCustomAttr("theme_url", "8FB1D3"); 
LD_AddCustomAttr("LangId", "1");
LD_AddCustomAttr("Autotag", "health");
LD_AddCustomAttr("Autotag", "technology");
LD_AddCustomAttr("Autotag", "entertainment");
LD_AddCustomAttr("Tag", "exercises");

LD_AddSlot("wpcom_below_post");
LD_GetBids();
</script>
</div><div class="sharedaddy sd-like-enabled"><div id="wpl-likebox" class="sd-block sd-like"><h3 class="sd-title">Like this:</h3><div class="sd-content"><div id="wpl-button"><a href="http://programmingpraxis.com/2009/06/26/treaps/?like=1&amp;_wpnonce=a72c2c6ab5" title="I like this post" class="like needs-login sd-button" rel="nofollow"><span>Like</span></a></div><div id="wpl-count" class="sd-like-count">Be the first to like this post.</div></div></div></div> <p>Pages: 1 <a href="http://programmingpraxis.com/2009/06/26/treaps/2/">2</a></p> </div></div>
</body>
</html>
