<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
<title>Wheel Factorization &laquo;  Programming Praxis</title>
</head>
<body>
<div class="entrytitle">
<h2>Wheel&nbsp;Factorization</h2>
<h3>May 8, 2009</h3>
</div>
<div class="entrybody">
<p>Having discussed prime numbers in <a href="/2009/02/19/sieve-of-eratosthenes">several</a> <a href="/2009/04/14/google-treasure-hunt-2008-puzzle-4">previous</a> <a href="/2009/05/01/primality-checking">exercises</a>, we are now interested in the problem of factoring an integer <em>n</em>; for instance, the prime factors of 42 are 2, 3, and 7.  A simple factoring method is to perform trial division by all the integers counting from 2 to the square root of <em>n</em>.  Your first task is to write that function.</p>
<p>An easy optimization is to divide only by 2 and then by odd integers greater than 2, which saves half the work.  A better optimization is to divide by 2, then 3, then 5, and thereafter to alternately add 2 and 4 to the trial divisors &#8212; 7, 11, 13, 17, 19, 23, and so on &#8212; since all prime numbers greater than 3 are of the form 6<em>k</em>Â±1 for some integer <em>k</em>.</p>
<p>It turns out that both those optimizations are special cases of a technique called wheel factorization.  Consider a 2-wheel of circumference 2 rolling along a number line with a &#8220;spoke&#8221; at the number 1; if you start with the spoke at 3 on the number line, it will strike the number line at 5, then 7, and then every odd number after that.  Or consider a 2,3-wheel of circumference 2&times;3=6 with spokes at the number 1 and 5; if you start with the 5-spoke at 5 on the number line, it will strike the number line at 7, 11, 13, 17, 19, 23, and so on.  Or consider a 2,3,5-wheel of circumference 2&times;3&times;5=30 with spokes at 1, 7, 11, 13, 17, 19, 23 and 29 starting with the 29-spoke at 7.  And so on: next is a 2,3,5,7-wheel, then a 2,3,5,7,11-wheel, and the sequence continues infinitely.</p>
<p>Wheel factorization works by performing trial division at each place where a spoke touches the number line.  As the wheels grow larger, more and more of the trial divisors are prime, so less and less unnecessary work is done.  Of course, there is a point of diminishing returns; when the wheel gets too large, it is just as much work to compute the wheel as to compute the list of primes, and costs just as much to store.  But a small wheel is easy to compute, and not too big, and provides a simple optimization over naive trial division.</p>
<p>The spokes of the wheel are computed by looking for co-primes, which are those numbers for which the spoke has no factors in common with the circumference of the wheel; in other words, where the greatest common divisor of the spoke and the circumference is 1.  For instance, a 2,3,5-wheel has a spoke at 17 because the greatest common divisor of 17 and 30 is 1, but no spoke at 18 because the greatest common divisor of 18 and 30 is 6.  These numbers are called totatives; if you&#8217;re curious about the math behind them, ask your favorite search engine for information about Euler&#8217;s totient function.</p>
<p>It is easy to see this visually.  Here is a list of the positive integers to 42, with primes highlighted:</p>
<p><code>&nbsp;1&nbsp;&nbsp;<em><strong>2</strong></em>&nbsp;&nbsp;<em><strong>3</strong></em>&nbsp;&nbsp;4&nbsp;&nbsp;<em><strong>5</strong></em>&nbsp;&nbsp;6<br />
&nbsp;<em><strong>7</strong></em>&nbsp;&nbsp;8&nbsp;&nbsp;9 10 <em><strong>11</strong></em> 12<br />
<em><strong>13</strong></em> 14 15 16 <em><strong>17</strong></em> 18<br />
<em><strong>19</strong></em> 20 21 22 <em><strong>23</strong></em> 24<br />
25 26 27 28 <em><strong>29</strong></em> 30<br />
<em><strong>31</strong></em> 32 33 34 35 36<br />
<em><strong>37</strong></em> 38 39 40 <em><strong>41</strong></em> 42</code></p>
<p>After the first row, all the primes are in two columns, which correspond to the two spokes of a 2,3-wheel.  If 853 were input to the 2,3-wheel factorization function, we would trial divide by 2, 3, 5, 7, 11, 13, 17, 19, 23, 25,and 29 before concluding that 853 was prime; note that 25 is not prime, but is relatively prime to the circumference of the wheel.</p>
<p>Your second task is to write a function that finds the factors of a given number using wheel factorization; you should compute and use a 2,3,5,7-wheel.  What are the factors of 600851475143?  When you are finished, you are welcome to <a href="/2009/5/8/wheel-factorization/2/">read</a> or <a href="http://codepad.org/3kwNA12j">run</a> a suggested solution, or post your own solution or discuss the exercise in the comments below.</p>
</div>
</body>
</html>
