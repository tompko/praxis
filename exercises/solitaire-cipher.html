<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
<title>Solitaire Cipher &laquo;  Programming Praxis</title>
</head>
<body>
<div class="entrytitle">
<h2>Solitaire&nbsp;Cipher</h2>
<h3>January 18, 2011</h3>
</div>
<div class="entrybody">
<p>In his book <em>Cryptonomicon</em>, Neal Stephenson has his characters communicate using a cipher called Pontifex.  Pontifex is based on the <a href="http://www.schneier.com/solitaire.html">Solitaire cipher</a> developed by Bruce Schneier, and uses an ordinary deck of cards, thirteen cards in each of four suits, plus two distinguishable jokers, to generate a keystream that is added to plain-text to form cipher-text, or subtracted from cipher-text to form plain-text.</p>
<p>After the deck is keyed, a single step consists of four operations on the deck.  First, the &#8220;A&#8221; joker is moved one card down the deck, wrapping around the end of the deck if necessary.  Second, the &#8220;B&#8221; joker is moved two cards down the deck, again wrapping around the deck if necessary.  Third, a triple-cut swaps all the cards above the highest joker in the deck with all the cards below the lowest joker in the deck, leaving the two jokers and the cards between them in place.  Fourth, a counted cut, based on the number of the bottom card in the deck, moves the top &#8220;count&#8221; cards to just above the bottom card; the cards are numbered 1 to 52 in &#8220;bridge order&#8221; with ace low to king high in each suit, clubs, diamonds, hearts, spades, and either joker counting as 53.  Then look at the top card in the deck and count down the given number to determine the current key card.</p>
<p>For example, given an initial deck in bridge order 1, 2, &#8230;, 52, A, B, where the two jokers are A and B, the first operation moves the A joker one card down the deck leaving 1, 2, &#8230;, 52, B A, the second operation moves the B joker two cards down the deck leaving 1, B, 2, &#8230;, 52, A, the third operation performs a triple cut (the second half of the cut is empty) leaving B, 2, &#8230;, 52, A, 1, and the fourth step performs a count cut taking one card (because the bottom card on the deck is 1) leaving 2, &#8230;, 52, A, B, 1.  Then the output card is 4, the four of clubs, because the top card of the deck is 2 and the second card below it is 4.</p>
<p>Before encrypting or decrypting a message, the deck must be &#8220;keyed.&#8221;  Begin with a deck in bridge order and perform a single step.  Then, for each character in the key, do a counted cut on the number of the current character, with A=1 &#8230; Z=26, followed by another single step.  Once the deck is keyed and you have a keystream, each character is added (for encryption) or subtracted (for decryption) from the current text character, wrapping around the alphabet as necessary, so that A+A=B and T+Q=K; note that Z is the identity character, so F+Z=F.  The plain-text has nulls (the letter X) added to the end to make the message length a multiple of five, and the cipher-text is split into five-character blocks for convenience.</p>
<p>Schneier gives three examples.  Given the plaintext AAAAAAAAAA and null key, the keystream is 4 49 10 (53) 24 8 51 44 6 4 33 (the joker is skipped) and the ciphertext is EXKYI  ZSGEH.  Given the plaintext AAAAAAAAAAAAAAA and key FOO, the keystream is 8 19 7 25 20 (53) 9 8 22 32 43 5 26 17 (53) 38 48 and the ciphertext is ITHZU  JIWGR  FARMW.  Given the plaintext SOLITAIRE and key CRYPTONOMICON, the keystream is 44 46 32 18 17 18 23 44 22 42 and the ciphertext is KIRAK SFJAN.</p>
<p>If you actually run the cipher with a deck of cards, you will find that, with just a little practice, your hands work the keystream generator themselves with little conscious thought, and you will soon memorize the wrap-around character addition rules like T+Q=K; the biggest problem with the cipher, like any output-feedback cipher, is that a single mistake renders all trailing text unreadable.  This cipher is best used for low-volume transmission of short messages.  If you use it for real security, your key should have at least eighty characters, and you should never use the same key to transmit two different messages.  An easy way for two communicants to manage keys is for both to use some printed source, say the lead editorial in the daily newspaper or the pages of a favorite novel (be sure both are using the same edition), selecting the key as the first 80 characters starting at the 37th, say, and giving the date or page as a header to the encrypted message.</p>
<p>Your task is to write functions that encrypt and decrypt using the solitaire cipher.  When you are finished, you are welcome to <a href="/2011/01/18/solitaire-cipher/2/">read</a> or <a href="http://programmingpraxis.codepad.org/PDJGeldx">run</a> a suggested solution, or to post your own solution or discuss the exercise in the comments below.</p>
</div>
</body>
</html>
